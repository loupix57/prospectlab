#!/usr/bin/env bash

# Installation d'un set d'outils Pentest sur Raspbian Trixie / RPi (arm64)
# Exécution : bash scripts/linux/install_pentest_tools_trixie.sh

set -e

echo "[*] Mise à jour APT..."
sudo apt-get update

install_pkg() {
  local pkg="$1"
  if sudo apt-get install -y "$pkg"; then
    echo "[✓] $pkg installé"
  else
    echo "[!] $pkg indisponible sur cette distro, à installer manuellement si besoin"
  fi
}

echo "[*] Installation des prérequis..."
install_pkg curl
install_pkg git
install_pkg python3-pip
install_pkg python3-venv
install_pkg pipx || true
pipx ensurepath || true

echo "[*] Scanners web et vulnérabilités..."
install_pkg sqlmap
install_pkg nikto
install_pkg wapiti
install_pkg zaproxy
install_pkg ffuf
install_pkg wfuzz
install_pkg dirsearch
install_pkg feroxbuster
install_pkg gobuster

echo "[*] Bruteforce / mots de passe..."
install_pkg john
install_pkg hashcat
install_pkg hydra
install_pkg medusa
install_pkg crunch
install_pkg cewl
install_pkg wordlists

echo "[*] Réseau / scan..."
install_pkg nmap
install_pkg masscan
install_pkg tcpdump
install_pkg wireshark
install_pkg ettercap-text-only
install_pkg bettercap
install_pkg responder
install_pkg impacket-scripts
install_pkg netcat-openbsd
install_pkg socat
install_pkg proxychains4
install_pkg sshuttle

echo "[*] Post-exploitation / AD..."
install_pkg bloodhound
install_pkg crackmapexec

echo "[*] Reverse / binaire..."
install_pkg radare2
install_pkg gdb
install_pkg binwalk
install_pkg binutils

echo "[*] Stéganographie..."
install_pkg steghide
echo "[!] Outguess non dispo via apt sur Trixie, installer manuellement si nécessaire"

echo "[*] Outils via pipx (hors dépôts apt)..."
pipx install droopescan || true

echo "[*] Remarques:"
echo "  - wpscan, arachni, metasploit peuvent nécessiter des dépôts/archives spécifiques."
echo "  - Pense à rouvrir le terminal ou source ~/.bashrc si pipx vient d'être installé."

echo "[*] Vérifications rapides..."
for tool in sqlmap nikto ffuf nmap masscan john hashcat; do
  if command -v "$tool" >/dev/null 2>&1; then
    echo "[OK] $tool détecté"
  else
    echo "[KO] $tool manquant"
  fi
done

echo "[*] Installation Pentest (Trixie) terminée."

