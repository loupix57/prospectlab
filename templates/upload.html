{% extends "base.html" %}

{% block title %}Importer Excel - ProspectLab{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Importer un fichier Excel</h1>
    <p>Uploadez un fichier Excel contenant vos entreprises à analyser</p>
</div>

<div class="upload-section">
    <form method="POST" enctype="multipart/form-data" class="upload-form" id="upload-form">
        <div class="form-group">
            <label for="file">Fichier Excel (.xlsx, .xls)</label>
            <input type="file" id="file" name="file" accept=".xlsx,.xls" required>
            <small>Format attendu : colonnes avec au minimum "name" et "website"</small>
        </div>
        
        <button type="submit" class="btn btn-primary" id="upload-btn">Importer</button>
    </form>
    
    <!-- Barre de progression -->
    <div id="upload-progress" class="upload-progress" style="display: none; margin-top: 1rem;">
        <div class="progress-bar" style="width: 100%; height: 30px; background: #f0f0f0; border-radius: 4px; overflow: hidden; margin-bottom: 0.5rem;">
            <div id="progress-fill" class="progress-fill" style="height: 100%; background: linear-gradient(90deg, #3498db, #2980b9); width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px;">0%</div>
        </div>
        <div id="progress-details" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; font-size: 12px; color: #666;">
            <span id="progress-text">Préparation de l'upload...</span>
            <span id="progress-stats" style="margin-left: auto; display: flex; gap: 1rem;">
                <span id="progress-speed">-</span>
                <span id="progress-eta">-</span>
            </span>
        </div>
        <div id="progress-bytes" style="text-align: center; font-size: 11px; color: #999; margin: 0;">
            <span id="progress-loaded">0</span> / <span id="progress-total">0</span>
        </div>
    </div>
    
    <!-- Messages d'erreur -->
    <div id="upload-status" class="status-message" style="display: none; margin-top: 1rem;"></div>
</div>

<div class="info-box">
    <h3>Format du fichier Excel</h3>
    <p>Votre fichier Excel doit contenir au minimum les colonnes suivantes :</p>
    
    <h4>Champs obligatoires</h4>
    <ul>
        <li><strong>name</strong> : Nom de l'entreprise (obligatoire)</li>
    </ul>
    
    <h4>Champs recommandés</h4>
    <ul>
        <li><strong>website</strong> : URL du site web (recommandé pour les analyses techniques)</li>
        <li><strong>category</strong> : Catégorie de l'entreprise (ex: restaurant, bank, bar, etc.)</li>
        <li><strong>category_translate</strong> : Catégorie traduite en français</li>
    </ul>
    
    <h4>Adresse et localisation</h4>
    <ul>
        <li><strong>address_1</strong> : Nom et numéro de la rue</li>
        <li><strong>address_2</strong> : Ville et code postal</li>
        <li><strong>address_full</strong> : Adresse complète (nom, numéro, ville, région, code postal) - utilisé si address_1/address_2 absents</li>
        <li><strong>country</strong> : Pays</li>
        <li><strong>longitude</strong> : Longitude (coordonnées GPS)</li>
        <li><strong>latitude</strong> : Latitude (coordonnées GPS)</li>
        <li><strong>timezone</strong> : Fuseau horaire de l'adresse</li>
    </ul>
    
    <h4>Contact</h4>
    <ul>
        <li><strong>phone_number</strong> : Numéro de téléphone</li>
    </ul>
    
    <h4>Évaluations Google</h4>
    <ul>
        <li><strong>rating</strong> : Note moyenne (sur 5) depuis Google Business</li>
        <li><strong>reviews_count</strong> : Nombre d'avis depuis Google Business</li>
    </ul>
    
    <h4>Informations supplémentaires</h4>
    <ul>
        <li><strong>language</strong> : Langue dans laquelle les informations sont écrites</li>
        <li><strong>language_code</strong> : Code de langue (ex: en, fr, it, etc.)</li>
        <li><strong>image_source</strong> : Lien de l'image par défaut affichée sur Google Maps</li>
        <li><strong>place_url</strong> : URL Google Maps de l'établissement</li>
    </ul>
    
    <div class="info-note">
        <p><strong>Note importante :</strong> Le système détecte automatiquement les doublons basés sur le nom, le site web et l'adresse. Les entreprises en double seront ignorées lors de l'import.</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/upload.js') }}" defer></script>
{% endblock %}

