{% extends "base.html" %}

{% block title %}Campagnes Email - ProspectLab{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/campagnes.css') }}">
{% endblock %}

{% block content %}
<div class="campagnes-container">
    <div class="page-header">
        <h1>Campagnes Email</h1>
        <button class="btn-new-campagne" onclick="openNewCampagneModal()">
            + Nouvelle campagne
        </button>
    </div>

    <div id="campagnes-grid" class="campagnes-grid">
        <div class="loading">Chargement des campagnes...</div>
    </div>
</div>

<!-- Modal pour cr√©er une campagne -->
<div id="campagne-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Nouvelle campagne email</h2>
            <button class="close-modal" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="campagne-form">
                <div class="form-section">
                    <div class="form-section-title">Informations de la campagne</div>

                    <div class="form-group">
                        <label for="campagne-template">Mod√®le de message</label>
                        <select id="campagne-template" name="template_id">
                            <option value="">Aucun (message personnalis√©)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="campagne-sujet">Sujet de l'email *</label>
                        <input type="text" id="campagne-sujet" name="sujet" required placeholder="Ex: Partenariat d√©veloppement web">
                    </div>

                    <div class="form-group">
                        <label for="campagne-message">Message personnalis√© (si aucun mod√®le)</label>
                        <textarea id="campagne-message" name="custom_message" rows="8" placeholder="Votre message... (peut contenir {nom}, {entreprise}, {email})"></textarea>
                        <div id="template-preview" style="display: none;"></div>
                        <div style="margin-top: 10px; font-size: 0.85em; color: #666;">
                            <em>Les mod√®les HTML sont affich√©s en aper√ßu. Le contenu sera automatiquement utilis√© lors de l'envoi.</em>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="campagne-delay">D√©lai entre envois (secondes)</label>
                        <input type="number" id="campagne-delay" name="delay" value="2" min="1" max="10">
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">S√©lection des destinataires</div>

                    <div class="form-group">
                        <label>Entreprises avec emails disponibles</label>
                        <div id="recipients-selector" class="recipients-selector">
                            <div class="loading">Chargement des entreprises...</div>
                        </div>
                        <div id="selected-count" class="selected-count" style="display: none;">
                            0 destinataire(s) s√©lectionn√©(s)
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-cancel" onclick="closeModal()">Annuler</button>
            <button type="submit" class="btn-submit" onclick="submitCampagne()">Lancer la campagne</button>
        </div>
    </div>
</div>

<!-- Modale de r√©sultats de campagne -->
<div id="results-modal" class="modal-results">
    <div class="modal-results-content">
        <div class="modal-results-header">
            <div class="modal-results-title">
                <h2>üìä R√©sultats de la campagne</h2>
                <span id="results-campagne-name" class="results-campagne-name"></span>
            </div>
            <button class="modal-results-close" onclick="closeResultsModal()">&times;</button>
        </div>
        <div class="modal-results-body" id="results-modal-body">
            <div class="results-loading">
                <div class="loading-spinner"></div>
                <p>Chargement des r√©sultats...</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/campagnes.js') }}"></script>
{% endblock %}

